(()=>{"use strict";const t='\n<style rel="stylesheet/css">\n    .silegismg-editor-base {\n        border: solid 1px #ccc;\n        border-top: none;\n    }\n\n    .silegismg-editor-base .silegismg-editor-botoes {\n        background: #ccc;\n        padding: 18px 4px 4px 4px;\n    }\n\n    .silegismg-editor-base .silegismg-editor-botoes .silegismg-editor-botoes-agrupamento {\n        display: inline-block;\n        margin-right: 1ex;\n    }\n\n    .silegismg-editor-base .silegismg-editor-botoes .silegismg-editor-botoes-agrupamento:before {\n        content: attr(data-agrupamento);\n        position: absolute;\n        margin-top: -1.3em;\n        font-size: 12px;\n    }\n\n    .silegismg-editor-base .silegismg-editor-botoes button[disabled] {\n        opacity: .5;\n    }\n\n    .silegismg-editor-base .silegismg-editor-botoes button.atual {\n        background: white;\n        color: black;\n        border: white 2px;\n        padding: 2px 1ex;\n        font-weight: bolder;\n    }\n\n    .silegismg-editor-base .silegismg-editor-conteudo {\n        margin: 2ex;\n    }\n</style>\n<div class="silegismg-editor-base">\n    \x3c!-- Barra de ferramentas para alterar formatação de dispositivos --\x3e    \n    <div class="silegismg-editor-botoes">\n        <div class="silegismg-editor-botoes-agrupamento" data-agrupamento="Divisão do texto">\n            <button data-tipo-destino="titulo">Título</button>\n            <button data-tipo-destino="capitulo">Capítulo</button>\n            <button data-tipo-destino="secao">Seção</button>\n            <button data-tipo-destino="subsecao">Subseção</button>\n        </div>\n        <div class="silegismg-editor-botoes-agrupamento" data-agrupamento="Formatação de dispositivos">\n            <button data-tipo-destino="continuacao">Continuação</button>\n            <button data-tipo-destino="artigo">Artigo</button>\n            <button data-tipo-destino="paragrafo">Parágrafo</button>\n            <button data-tipo-destino="inciso">Inciso</button>\n            <button data-tipo-destino="alinea">Alínea</button>\n            <button data-tipo-destino="item">Item</button>\n        </div>\n    </div>\n    <div class="silegismg-editor-conteudo">\n    </div>\n</div>\n';!function(){if("function"==typeof window.CustomEvent)return!1;function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var o=document.createEvent("CustomEvent");return o.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),o}t.prototype=window.Event.prototype,window.CustomEvent=t}();const e=class{constructor(t,e){this.nome=t,this.dados=e}getCustomEvent(){return new CustomEvent(this.nome,this.dados)}},o=class extends e{constructor(t){super("contexto",{detail:t})}},i=class{constructor(t,e){let o,i={italico:"I"===e.tagName,desconhecido:!1,titulo:!1,capitulo:!1,secao:!1,subsecao:!1,artigo:!1,continuacao:!1,paragrafo:!1,inciso:!1,alinea:!1,item:!1,raiz:!1,elemento:e,get tipo(){return this.dispositivo?this.dispositivo.getAttribute("data-tipo"):"desconhecido"}};for(;e&&e!==t&&!e.hasAttribute("data-tipo");)e=e.parentElement;for(i.dispositivo=e!==t?e:null;e&&"continuacao"===e.getAttribute("data-tipo");)e=e.previousElementSibling,i.continuacao=!0;e?e===t?e.raiz=!0:e.hasAttribute("data-tipo")?i[e.getAttribute("data-tipo")]=!0:i.desconhecido=!0:i.desconhecido=!0,Object.defineProperty(i,"primeiroDoTipo",{get:function(){return void 0===o&&(o=e&&function(t){var e=t.getAttribute("data-tipo");if(!e)return null;for(;"continuacao"===e;)dispositvo=t.previousElementSibling,e=t.getAttribute("data-tipo");let o={parte:[],livro:[],titulo:[],capitulo:["titulo"],secao:["capitulo","titulo"],subsecao:["secao","capitulo","titulo"],artigo:[],paragrafo:["artigo"],inciso:["paragrafo","artigo"],alinea:["inciso"],item:["alinea"]}[e].reduce(((t,e)=>(t[e]=!0,t)),{});for(let i=t.previousElementSibling;i;i=i.previousElementSibling){let t=i.getAttribute("data-tipo");if(t===e)return!1;if(o[t])return!0}return!0}(e)),o}}),i.dispositivoAnterior=i.continuacao?e:e&&function(t,e){for(;t&&!t.hasAttribute("data-tipo")&&t!==e;)t=t.parentElement;if(!t||t===e)return null;for(let e=t.previousElementSibling;e;e=e.previousElementSibling)if(e.hasAttribute("data-tipo")&&"continuacao"!==e.getAttribute("data-tipo"))return e;return null}(e,t),i.tipoAnterior=i.dispositivoAnterior&&i.dispositivoAnterior.getAttribute("data-tipo");let n=Element.prototype.matches||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.onMatchesSelector||function(){return!0};function r(t,e){return t&&n.call(t,'p[data-tipo="'+e+'"] ~ *')}let a="titulo"===i.tipoAnterior||"capitulo"===i.tipoAnterior||"secao"===i.tipoAnterior||"subsecao"===i.tipoAnterior,s={titulo:!a,capitulo:!a||"titulo"===i.tipoAnterior,get secao(){return(!a||"capitulo"===i.tipoAnterior)&&r(i.dispositivo,"capitulo")},get subsecao(){return(!a||"secao"===i.tipoAnterior)&&r(i.dispositivo,"secao")},artigo:!0,continuacao:"artigo"===i.tipoAnterior,inciso:i.tipoAnterior&&!a&&(!i.artigo||i.artigo&&!i.primeiroDoTipo),paragrafo:i.tipoAnterior&&!a&&(!i.artigo||i.artigo&&(!i.primeiroDoTipo||i.continuacao)),alinea:i.inciso&&!i.primeiroDoTipo||"inciso"===i.tipoAnterior||"alinea"===i.tipoAnterior||"item"===i.tipoAnterior,item:i.alinea&&!i.primeiroDoTipo||"alinea"===i.tipoAnterior||"item"===i.tipoAnterior};Object.defineProperty(this,"cursor",{value:i}),Object.defineProperty(this,"permissoes",{value:s}),Object.freeze(this),Object.freeze(i),Object.freeze(s)}comparar(t){for(let e in this.cursor)if(this.cursor[e]!==t.cursor[e])return!0;for(let e in this.permissoes)if(this.permissoes[e]!==t.permissoes[e])return!0;return!1}get valido(){return this.permissoes[this.cursor.tipo]}},n=class extends e{constructor(t,e,o,i){super("transformacao",{detail:{automatica:!0,tipoAnterior:e,novoTipo:o,transformacao:i,editorArticulacaoCtrl:t}})}};class r{constructor(){this.sequencias=[];for(let t=0;t<arguments.length;t++){let e=arguments[t];this.sequencias.push(e),e.indexOf("\n")>=0&&this.sequencias.push(e.replace(/\n/g,"\r"))}}get tipoTransformacao(){return this.constructor.name}transformar(t,e,o,i,n){throw"Método não implementado"}}class a extends r{transformar(t,e,o){let i=this.proximoTipo(t,e,o);i&&function(t,e,o){var i=function(e){o(),t.removeEventListener("keyup",i)};t.addEventListener("keyup",i)}(t,o.cursor.elemento,(()=>{let t=e.contexto.cursor.tipo;e.alterarTipoDispositivoSelecionado(i),e.dispatchEvent(new n(e,t,i,this.tipoTransformacao))}))}proximoTipo(t,e,o){throw"Método não implementado"}}const s=r,l=class extends a{constructor(){super(":\n")}get tipoTransformacao(){return"DoisPontos"}proximoTipo(t,e,o){return{artigo:"inciso",inciso:"alinea",alinea:"item",paragrafo:"inciso"}[o.cursor.tipo]}},c=class extends a{constructor(){super(".\n")}get tipoTransformacao(){return"PontoFinal"}proximoTipo(t,e,o){return{get inciso(){let t,e=o.cursor.dispositivo;do{e=e.previousElementSibling,t=e.getAttribute("data-tipo")}while("artigo"!==t&&"paragrafo"!==t);return t},alinea:"inciso",item:"alinea"}[o.cursor.tipo]}},d=class extends r{constructor(){super('\n"')}get tipoTransformacao(){return"AoIniciarAspas"}transformar(t,e,o){return"artigo"===o.cursor.tipoAnterior&&(e.alterarTipoDispositivoSelecionado("continuacao"),e.dispatchEvent(new n(e,"artigo","continuacao",this.tipoTransformacao))),null}},u=class extends a{constructor(){super('"\n','".\n')}get tipoTransformacao(){return"AoFecharAspas"}proximoTipo(t,e,o){return o.cursor.artigo&&o.cursor.continuacao?"artigo":null}},p=class extends s{constructor(){super("\n")}get tipoTransformacao(){return"RecuarComEnterEmDispositivoVazio"}transformar(t,e,o,i,n){if(0===o.cursor.dispositivo.textContent.trim().length){let t={item:"alinea",alinea:"inciso",get inciso(){for(let t=o.cursor.dispositivoAnterior;t;t=t.previousElementSibling){let e=t.getAttribute("data-tipo");if("artigo"===e||"paragrafo"===e)return e}return"artigo"}}[o.cursor.tipo]||"artigo";e.alterarTipoDispositivoSelecionado(t),n.preventDefault()}}};function m(t,e){e.sequencias.forEach((function(o){var i,n,r=t,a=e.transformar.bind(e);for(i=0;i<o.length;i++)r[n=o.charCodeAt(i)]||(r[n]={}),r=r[n];let s={sequencia:o,handler:a};r.$handler?r.$handler.push(s):r.$handler=[s]}))}function g(t,e,o){if(!t)throw"Objeto não fornecido.";if(!e)throw"Método não fornecido.";if(!o)throw"Interceptador não fornecido.";if("function"==typeof t)g(t.prototype,e,o);else{let i=t[e];if(!i)throw"Método não encontrado: "+e;t[e]=function(){return o(this,i,arguments)}}}function h(t,e,o){if(!t)throw"Objeto não fornecido.";if(!e)throw"Método não fornecido.";if(!o)throw"Interceptador não fornecido.";if("function"==typeof t)h(t.prototype,e,o);else{let i=t[e];if(!i)throw"Método não encontrado: "+e;t[e]=function(){var t=i.apply(this,arguments);return o(this,t,arguments)}}}function f(t,e,o){let i=t.contexto.cursor.dispositivo,n=b(i),r=e.apply(t,o),a=b(i,n.hash);for(let e=0,o=t.contexto.cursor.dispositivo.nextElementSibling;o&&e<a.total;o=o.nextElementSibling){let t=o.getAttribute("data-tipo"),i=b(o);a.hash[t]&&v(o);for(let t in i.hash)a.hash[t]&&(a.hash[t]=!1,e++)}return r}function b(t,e){let o=getComputedStyle(t).counterReset,i={},n=0;for(let t=/(.+?)\s\d+\s*/g,r=t.exec(o);r;r=t.exec(o)){let t=r[1];e&&e[t]||(i[t]=!0,n++)}return{total:n,hash:i}}function v(t){let e=t.getAttribute("data-tipo");t.removeAttribute("data-tipo"),setTimeout((()=>t.setAttribute("data-tipo",e)))}const x=function(t){t.limpar=function(){this._elemento.innerHTML='<p data-tipo="artigo">&nbsp;</p>'},g(DOMTokenList.prototype,"toggle",((t,e,o)=>{1===o.length?e.apply(t,o):o[1]?t.add(o[0]):t.remove(o[0])})),0===new Set([1,2]).size&&function(){function t(t){"function"==typeof e.prototype[t]&&(window.Set.prototype[t]=function(){return this.$set[t].apply(this.$set,arguments)})}let e=window.Set;window.Set=function(t){if(this.$set=new e,t)for(let e in t)this.$set.add(t[e])};let o=["add","clear","delete","entries","forEach","has","keys","values","@@iterator"];for(let e=0;e<o.length;e++)t(o[e])}(),h(t,"_normalizarDispositivo",(function(t,e,o){let i=o[0];i&&!i.firstElementChild&&""===i.textContent&&(i.innerHTML="&nbsp;")}))};function E(t,e,o,i){let n;switch(typeof o){case"string":n=()=>o;break;case"function":n=o;break;default:throw new Error("Tipo final não é literal nem função.")}if(e){var r=t.querySelectorAll(e);for(let t=0;t<r.length;t++){let e=r[t].cloneNode(!0);e.setAttribute("data-tipo",n(t,e)),i.appendChild(e)}}else{let e=t.cloneNode(!0);e.setAttribute("data-tipo",n(0,e)),i.appendChild(e)}return i}const C=function t(e,o){if(o||(o=document.createDocumentFragment()),!e)return o;if(e instanceof NodeList||e instanceof HTMLCollection)for(let i=0;i<e.length;i++)t(e[i],o);else if("string"==typeof e){let i=document.createElement("html");i.innerHTML=e.replace(/<([^ >]+)\s*\/>/g,"<$1></$1>"),t(i.querySelector("body").children,o)}else switch(e.tagName){case"ARTICULACAO":t(e.children,o);break;case"TITULO":case"CAPITULO":case"SECAO":case"SUBSECAO":o.appendChild(function(t,e){let o=document.createElement("p");return o.setAttribute("data-tipo",t),o.innerHTML=e,o}(e.tagName.toLowerCase(),e.querySelector("NomeAgrupador").innerHTML)),t(e.children,o);break;case"NOMEAGRUPADOR":case"ROTULO":case"P":break;case"ARTIGO":E(e,"Caput > p",(t=>0===t?"artigo":"continuacao"),o),/\d+º?-[A-Z]/.test(e.querySelector("Rotulo").textContent)&&o.lastElementChild.classList.add("emenda"),t(e.querySelectorAll("Caput > Inciso"),o);let i=e.querySelectorAll("Paragrafo"),n=o.lastElementChild;t(i,o),1===i.length&&n.nextElementSibling.classList.add("unico");break;case"INCISO":case"ALINEA":case"ITEM":case"PARAGRAFO":let r=function(t){let e=t.firstElementChild;for(;"P"!==e.tagName;)e=e.nextElementSibling;return e}(e);E(r,null,e.tagName.toLowerCase(),o),t(e.children,o);break;default:throw"Elemento não esperado: "+e.tagName}return o},A=class{constructor(t,e){this.dispositivo=t,this.mensagem=e}get tipo(){return dispositivo.tagName}},w={escaparXML:!1,rotulo:{separadorArtigo:" –",separadorArtigoSemOrdinal:" –",separadorParagrafo:" –",separadorParagrafoSemOrdinal:" –",separadorParagrafoUnico:" –",separadorInciso:" –",separadorAlinea:")",separadorItem:")"},shadowDOM:!1,somenteLeitura:!1,transformacaoAutomatica:!0,validarAoAtribuir:!0,validacao:{caixaAlta:!0,citacao:!0,enumeracaoElementos:!0,inicialMaiuscula:!0,pontuacao:!0,pontuacaoEnumeracao:!0,sentencaUnica:!0}};var S=new Set(["SPAN","B","I","A","SUB","SUP","INS","DEL","DFN"]);function y(t,e,o,i,n,r,a){var s,l;switch(l=t.substr(0,3).toLowerCase(),l=o?o+"_"+l:l,l+=r?i+"-"+r:i+1,(s=document.createElementNS("http://www.lexml.gov.br/1.0",t)).setAttribute("id",l),s.appendChild(function(t,e,o,i,n){var r=document.createElementNS("http://www.lexml.gov.br/1.0","Rotulo");switch(t){case"Artigo":r.innerHTML=i?"Art. "+e+(e<10?"º-":"-")+O(i,!0)+(e<10?n.separadorArtigo:n.separadorArtigoSemOrdinal):"Art. "+e+(e<10?"º"+n.separadorArtigo:n.separadorArtigoSemOrdinal);break;case"Paragrafo":r.innerHTML=o?"Parágrafo único"+n.separadorParagrafoUnico:"§ "+e+(e<10?"º"+n.separadorParagrafo:n.separadorParagrafoSemOrdinal);break;case"Inciso":r.innerHTML=N(e)+n.separadorInciso;break;case"Alinea":r.textContent=O(e)+n.separadorAlinea;break;case"Item":r.innerHTML=e+n.separadorItem;break;case"Titulo":r.textContent="Título "+N(e);break;case"Capitulo":r.textContent="Capítulo "+N(e);break;case"Secao":r.textContent="Seção "+N(e);break;case"Subsecao":r.textContent="Subseção "+N(e);break;default:throw"Tipo não suportado na formatação de rótulo: "+t}return r}(t,r?i:i+1,n,r,a)),t){case"Artigo":s.appendChild(function(t,e){var o=document.createElementNS("http://www.lexml.gov.br/1.0","Caput"),i=L(t);return o.setAttribute("id",e+"_cpt"),o.appendChild(i),T(i),o}(e,l));break;case"Parte":case"Livro":case"Titulo":case"Capitulo":case"Secao":case"Subsecao":s.appendChild(function(t){var e=document.createElementNS("http://www.lexml.gov.br/1.0","NomeAgrupador");return _(t,e),e}(e));break;default:s.appendChild(L(e))}return s}function L(t){var e=document.createElementNS("http://www.lexml.gov.br/1.0","p");return _(t,e),T(e),e}function _(t,e){for(var o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null,null),i={anterior:null,retrocederEm:null,destino:e},n=!0,r=null;o.nextNode();){let e=o.currentNode;if(e.parentNode===i.retrocederEm&&(i=i.anterior),e.nodeType===Node.TEXT_NODE)r=e.cloneNode(),n&&(n=!1,r.textContent=r.textContent.replace(/^\s+/,"")),i.destino.appendChild(r);else if(S.has(e.tagName)){let t=document.createElementNS("http://www.lexml.gov.br/1.0",e.tagName.toLowerCase());i.destino.appendChild(t),i={anterior:i,retrocederEm:e.parentNode,destino:t}}else if("BR"!==e.tagName)throw new A(t,"Elemento não permitido: "+e.tagName)}return r&&(r.textContent=r.textContent.replace(/\s+$/,"")),e}function T(t){for(;t.hasAttributes();)t.removeAttribute(t.attributes[0].name);let e=t.children||t.childNodes;for(let i=0;i<e.length;i++)if("p"===e[i].tagName)for(;e.length>i;){let n=e[i];if("p"===n.tagName)t.parentNode.insertBefore(n,t.nextSibling),T(n);else{var o=document.createElementNS("http://www.lexml.gov.br/1.0","p");o.appendChild(n),t.parentNode.insertBefore(o,t.nextSibling),T(o)}}}function N(t){for(var e=String(t).split(""),o=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],i="",n=3;n--;)i=(o[+e.pop()+10*n]||"")+i;return new Array(+e.join("")+1).join("M")+i}function O(t,e){if(t<1)throw"Número deve ser positivo.";return String.fromCharCode((e?64:96)+t)}const I=function(t,e){var o=0;e||(e=w.rotulo);class i{constructor(t,e){this.dispositivoLexML=t,this.contextoAnterior=e,this.cntSubitens={get Artigo(){return o},set Artigo(t){o=t}}}get id(){return this.dispositivoLexML.id}getIdReferencia(t){return this.dispositivoLexML.id}get tipo(){return this.dispositivoLexML.tagName}adicionarSubitem(t){this.cntSubitens[t.tagName]=this.cntSubitens[t.tagName]?this.cntSubitens[t.tagName]+1:1,this.dispositivoLexML.appendChild(t)}adicionarSubitemEmendado(t){this.dispositivoLexML.appendChild(t)}adicionarProximo(t){this.dispositivoLexML.parentNode.appendChild(t)}possuiSubtipo(t){switch(this.tipo){case"Articulacao":return"Artigo"===t||"Titulo"===t||"Capitulo"===t||"Secao"===t||"Livro"===t||"Parte"===t;case"Parte":return"Livro"===t;case"Livro":return"Titulo"===t;case"Titulo":return"Capitulo"===t||"Artigo"===t;case"Capitulo":return"Secao"===t||"Artigo"===t;case"Secao":return"Subsecao"===t||"Artigo"===t;case"Subsecao":return"Artigo"===t;case"Artigo":return"Inciso"===t||"Paragrafo"===t;case"Inciso":return"Alinea"===t;case"Alinea":return"Item"===t;case"Item":return!1;case"Paragrafo":return"Inciso"===t;default:throw"Tipo desconhecido: "+this.tipo}}contarSubitens(t){return this.cntSubitens[t]||0}}class n extends i{getIdReferencia(t){return"Inciso"===t?this.dispositivoLexML.id+"_cpt":this.dispositivoLexML.id}adicionarSubitem(t){"p"===t.tagName||"Inciso"===t.tagName?this.dispositivoLexML.querySelector("Caput").appendChild(t):this.dispositivoLexML.appendChild(t),this.cntSubitens[t.tagName]=this.cntSubitens[t.tagName]?this.cntSubitens[t.tagName]+1:1}}class r extends i{getIdReferencia(t){return"Artigo"===t?null:super.getIdReferencia(t)}}function a(t,e){switch(t.tagName){case"Artigo":return new n(t,e);case"Parte":case"Titulo":case"Capitulo":case"Secao":case"Subsecao":return new r(t,e);default:return new i(t,e)}}let s=document.createElementNS("http://www.lexml.gov.br/1.0","Articulacao"),l=new i(s);for(t.classList.contains("silegismg-editor-articulacao")&&(t=t.firstElementChild);t;){let o=t.getAttribute("data-tipo").replace(/^[a-z]/,(t=>t.toUpperCase()));if(!o)throw new A(t,"Dispositivo não possui tipo definido.");if("Continuacao"===o){if(!l.contextoAnterior)throw new A(t,"Continuação não possui dispositivo anterior.");let e=L(t);l.adicionarSubitem(e)}else{for(;l&&!l.possuiSubtipo(o);)l=l.contextoAnterior;if(!l)throw new A(t,'Dispositivo do tipo "'+o.toLowerCase()+'" inesperado neste ponto.');t.classList.contains("emenda")?l.nEmenda++:l.nEmenda=0;let i=y(o,t,l.getIdReferencia(o),l.contarSubitens(o),t.classList.contains("unico"),l.nEmenda,e);"Paragrafo"===o&&t.classList.contains("unico")&&(i.id=i.id+"u"),l.nEmenda?l.adicionarSubitemEmendado(i):l.adicionarSubitem(i),l=a(i,l)}t=t.nextElementSibling}return s};function M(t){var e={ultimoItem:null,textoAnterior:"",artigos:[],getUltimoItemTipo:function(t){var e=this.ultimoItem;if(null===e)return null;if("function"==typeof t)for(;e&&!(e instanceof t);)e=e.$parent;else{if(!(t instanceof Array))throw"Argumento inválido";do{var o;for(o=0;o<t.length;o++)if(e instanceof t[o])return e;e=e.$parent}while(e)}return e}},o=[{item:"parentesis",regexp:/^\(.+\)$/,onMatch:function(t,e){return t.ultimoItem&&(t.ultimoItem.descricao?t.ultimoItem.descricao+=e[0]:t.ultimoItem.descricao=e[0]),t.ultimoItem}},{item:"continuacao-divisao",regexp:/^\s*(.*)?\s*$/,requisito:[H,X,U,F],onMatch:function(t,e){return t.ultimoItem.descricao?t.ultimoItem.descricao+=e[1]:t.ultimoItem.descricao=e[1],t.ultimoItem},reiniciar:!0},{item:"artigo",regexp:/^\s*(?:Art\.?|Artigo)\s*(\d+(?:-[a-z])?)\s*.\s*[-–]?\s*(.+)/i,onMatch:function(t,e){var o=new P(e[1],e[2]);return t.artigos.push(o),o}},{item:"paragrafo",regexp:/^\s*(?:Par[áa]grafo [úu]nico|(?:§|Par[áa]grafo)\s*(\d+|primeiro|segundo|terceiro|quarto|quinto|sexto|s[eé]timo|oitavo|nono))\s*.?\s*[-–]?\s*(.+)/i,onMatch:function(t,e){var o=new z(e[1]||"Parágrafo único",e[2]),i=t.getUltimoItemTipo(P);return i||(i=new P("",t.textoAnterior),t.artigos.push(i),t.textoAnterior=""),i.adicionar(o),o}},{item:"inciso",regexp:/^\s*([IXVDLM]+)\s*[-–).]\s*(.+)/,onMatch:function(t,e){var o=new R(e[1],e[2]),i=t.getUltimoItemTipo([P,z]);return i||(i=new P("",t.textoAnterior),t.artigos.push(i),t.textoAnterior=""),i.adicionar(o),o}},{item:"alinea",regexp:/^\s*([a-z])\s*[-–).]\s*(.*)/i,onMatch:function(t,e){var o=new j(e[1],e[2]),i=t.getUltimoItemTipo(R);if(!i){let e=t.getUltimoItemTipo([P,z]);e||(e=new P("",""),t.artigos.push(e)),i=new R("",t.textoAnterior),e.adicionar(i),t.textoAnterior=""}return i.adicionar(o),o}},{item:"item",regexp:/^\s*(\d)\s*[-–).]\s*(.*)/,onMatch:function(t,e){var o=new $(e[1],e[2]),i=t.getUltimoItemTipo(j);if(!i){i=new j("",t.textoAnterior);let e=t.getUltimoItemTipo(R);if(!e){let o=t.getUltimoItemTipo([P,z]);o||(o=new P("",""),t.artigos.push(o)),e=new R("",""),o.adicionar(e)}e.adicionar(i),t.textoAnterior=""}return i.adicionar(o),o}},{item:"titulo",regexp:/^\s*T[ÍI]TULO\s*([IXVDLM]+)(?:\s*[-–]\s*(.+))?/i,onMatch:function(t,e){var o=new H(e[1],e[2]||"");return t.artigos.push(o),o}},{item:"capitulo",regexp:/^\s*CAP[ÍI]TULO\s*([IXVDLM]+)(?:\s*[-–]\s*(.+))?/i,onMatch:function(t,e){var o=new X(e[1],e[2]||"");return t.artigos.push(o),o}},{item:"secao",regexp:/^\s*SE[ÇC][ÃA]O\s*([IXVDLM]+)(?:\s*[-–]\s*(.+))?/i,onMatch:function(t,e){var o=new U(e[1],e[2]||"");return t.artigos.push(o),o}},{item:"subsecao",regexp:/^\s*SUBSE[ÇC][ÃA]O\s*([IXVDLM]+)(?:\s*[-–]\s*(.+))?/i,onMatch:function(t,e){var o=new F(e[1],e[2]||"");return t.artigos.push(o),o}}],i=[];return t.replace(/(“[\s\S]*?”|"[\s\S]*?")/g,(function(t){return i.push(t.replace(/[“”]/g,'"')),"\0"})).replace(/\s*\n+\s*/g,"\n").split("\n").forEach((function(t){var n,r,a,s;for(n=0;n<o.length;n++){var l;if((r=o[n]).requisito){for(s=!1,l=0;l<r.requisito.length;l++)if(e.ultimoItem instanceof r.requisito[l]){s=!0;break}}else s=!0;if(s&&(a=r.regexp.exec(t)))return e.ultimoItem=r.onMatch(e,a),void(e.ultimoItem&&(e.ultimoItem.descricao=e.ultimoItem.descricao.replace(/\0/g,i.shift.bind(i)),r.reiniciar&&(e.ultimoItem=null)))}t=t.replace(/\0/g,(function(){return i.shift()})),e.ultimoItem?e.ultimoItem.descricao+="\n"+t:e.artigos.length>0&&e.artigos[e.artigos.length-1]instanceof q?e.artigos[e.artigos.length-1].descricao+="\n"+t:0===e.textoAnterior.length?e.textoAnterior=t:e.textoAnterior+="\n"+t})),{textoAnterior:e.textoAnterior,articulacao:e.artigos}}function D(t){var e=document.createDocumentFragment();if(-1===t.indexOf("\n")){let o=document.createElement("p");o.textContent=t,e.appendChild(o)}else t.split(/\n+/g).forEach((t=>{let o=document.createElement("p");o.textContent=t,e.appendChild(o)}));return e}class k{constructor(t,e,o,i){this.numero=e,this.descricao=o,Object.defineProperty(this,"tipo",{value:t}),i&&Object.defineProperty(this,"subitens",{get:function(){return i.reduce(((t,e)=>t.concat(this[e])),[])}})}adicionar(t){throw"Não implementado"}transformarConteudoEmFragmento(){return function(t){var e=document.createDocumentFragment();let o=document.createElement("p");return o.textContent=t.replace(/\n+/g," "),e.appendChild(o),e}(this.descricao)}paraEditor(){let t=this.transformarConteudoEmFragmento();t.firstElementChild.setAttribute("data-tipo",this.tipo);for(let e=t.children[1];e;e=e.nextElementSibling)e.setAttribute("data-tipo","continuacao");return this.subitens.forEach((e=>t.appendChild(e.paraEditor()))),t}}class P extends k{constructor(t,e){super("artigo",t,e,["incisos","paragrafos"]),this.incisos=[],this.paragrafos=[]}adicionar(t){var e=this;if(Object.defineProperty(t,"$parent",{get:function(){return e}}),t instanceof R)this.incisos.push(t);else{if(!(t instanceof z))throw"Tipo não suportado.";this.paragrafos.push(t)}}transformarConteudoEmFragmento(){return D(this.descricao)}paraEditor(){var t=super.paraEditor();return 1===this.paragrafos.length&&t.querySelector('p[data-tipo="paragrafo"]').classList.add("unico"),t}}class z extends k{constructor(t,e){super("paragrafo",t,e,["incisos"]),this.incisos=[]}adicionar(t){var e=this;if(!(t instanceof R))throw"Tipo não suportado.";Object.defineProperty(t,"$parent",{get:function(){return e}}),this.incisos.push(t)}}class R extends k{constructor(t,e){super("inciso",t,e,["alineas"]),this.alineas=[]}adicionar(t){var e=this;if(!(t instanceof j))throw"Tipo não suportado.";Object.defineProperty(t,"$parent",{get:function(){return e}}),this.alineas.push(t)}}class j extends k{constructor(t,e){super("alinea",t,e,["itens"]),this.itens=[]}adicionar(t){var e=this;if(!(t instanceof $))throw"Tipo não suportado.";Object.defineProperty(t,"$parent",{get:function(){return e}}),this.itens.push(t)}}class $ extends k{constructor(t,e){super("item",t,e,[])}}class q extends k{constructor(t,e,o){super(t,e,o),this.subitens=[]}adicionar(t){this.subitens.push(t)}}class H extends q{constructor(t,e){super("titulo",t,e)}}class X extends q{constructor(t,e){super("capitulo",t,e)}}class U extends q{constructor(t,e){super("secao",t,e)}}class F extends q{constructor(t,e){super("subsecao",t,e)}}function B(t){function e(t,e,o,i){var n=i.prefixo+"_inc"+(o+1);return t+'<Inciso id="'+n+'"><Rotulo>'+e.numero+"</Rotulo><p>"+e.descricao+"</p>"+(e.alineas||[]).reduce((function(t,e,o){return t+'<Alinea id="'+n+"_ali"+(o+1)+'"><Rotulo>'+e.numero+"</Rotulo><p>"+e.descricao+"</p></Alinea>"}),"")+"</Inciso>"}return'<Articulacao xmlns="http://www.lexml.gov.br/1.0">'+t.articulacao.reduce((function(t,o,i){var n="art"+(i+1),r=t+'<Artigo id="'+n+'"><Rotulo>Art. '+(i+1)+(i<9?"º":"")+' –</Rotulo><Caput id="'+n+'_cpt"><p>'+o.descricao+"</p>";return o.incisos&&o.incisos.length>0&&(o.incisos.prefixo=n+"_cpt",r+=o.incisos.reduce(e,"")),r+="</Caput>",o.paragrafos&&o.paragrafos.length>0&&(r+=o.paragrafos.reduce((function(t,o,i,r){var a=n+"_par"+(i+1);return o.incisos&&(o.incisos.prefixo=a),t+'<Paragrafo id="'+a+'"><Rotulo>'+(1===r.length?"Parágrafo único":"§"+(i+1)+(i<9?"º":""))+" –</Rotulo><p>"+o.descricao+"</p>"+(o.incisos||[]).reduce(e,"")+"</Paragrafo>"}),"")),r+"</Artigo>"}),"")+"</Articulacao>"}function V(t,e,o){var i,n,r;try{switch((o||"texto").toLowerCase()){case"texto":i=M(t);break;case"html":let e=document.createElement("div");e.innerHTML=t,i=M((n=e.innerHTML.replace(/<P>(.+?)<\/P>/gi,"$1\n").trim(),r=["&lt;","&gt;","&quot;","&amp;","&apos;"],n.replace(/&.+?;/g,(function(t){if(r.indexOf(t)>=0)return t;var e=document.createElement("span");return e.innerHTML=t,e.textContent}))));break;default:throw"Formato não suportado."}switch((e||"lexml").toLowerCase()){case"json":return i;case"lexml":return function(t){let e=B(t),o=document.createElement("div");o.innerHTML=e;let i=document.createDocumentFragment();for(;o.firstChild;)i.appendChild(o.firstChild);return i}(i);case"lexmlstring":case"lexml-string":return B(i);default:throw"Formato não suportado: "+e}}catch(o){throw{mensagem:"Erro interpretando articulação.",item:t,formato:e,erroOriginal:o}}}const W={Artigo:P,Paragrafo:z,Inciso:R,Alinea:j,Item:$,Titulo:H,Capitulo:X,Secao:U,Subsecao:F,interpretar:V,transformarQuebrasDeLinhaEmP:D};function K(t,e){if(0===t.length)return;var o=document.createDocumentFragment();let i=t.indexOf("\n");if(0!==i){let e=document.createTextNode(i>0?t.substr(0,i):t);o.appendChild(e)}if(-1!==i){let n=D(t.substr(i+1));o.appendChild(n);let r=[];if(o.firstChild.nodeType===Node.TEXT_NODE&&o.firstChild.textContent.endsWith(":")){let t=G(e);e!==t&&(r.push(e),e=t)}for(let t=o.firstElementChild;t;t=t.nextElementSibling)if(t.setAttribute("data-tipo",e),t.textContent.endsWith(":")){let t=G(e);e!==t&&(r.push(e),e=t)}else r.length>0&&t.textContent.endsWith(".")&&(e=r.pop())}return o}function G(t){switch(t){case"artigo":case"paragrafo":return"inciso";case"inciso":return"alinea";case"alinea":return"item";default:return null}}const Z=class{constructor(t,e){this.editorCtrl=t,this.validacaoCtrl=e,t.registrarEventListener("paste",(t=>function(t,e){var o=t.clipboardData||window.clipboardData,i=o.items;if(i)for(let o=0;o<i.length;o++)"text/plain"===i[o].type&&(i[o].getAsString(e.colarTexto.bind(e)),t.preventDefault());else o.getData&&(e.colarTexto(o.getData("text/plain")),t.preventDefault())}(t,this)))}colarTexto(t){let e=this.editorCtrl.getSelection().getRangeAt(0);e.collapsed||(e.deleteContents(),this.editorCtrl.atualizarContexto());for(let t=(e.endContainer.nodeType===Node.TEXT_NODE?e.endContainer.parentNode:e.endContainer).querySelectorAll("br"),o=0;o<t.length;o++)t[o].remove();let o=function(t,e,o){var i;if(o)i=K(t,"continuacao");else{let o=V(t,"json");if(o.textoAnterior&&(i=K(o.textoAnterior,e||"artigo")),o.articulacao.length>0){let t=function(t){let e=document.createDocumentFragment();return t.forEach((t=>e.appendChild(t.paraEditor()))),e}(o.articulacao);i?i.appendChild(t):i=t}}return i}(t,this.editorCtrl.contexto.cursor.tipo,this.editorCtrl.contexto.cursor.continuacao);!function(t,e,o){!function(t,e){var o=[];for(let e=0,i=t.childNodes.length;e<i;e++)o.push(t.childNodes[e]);let i=function(){let t=o[0].previousSibling,i=o[o.length-1].nextSibling;for(let t=0;t<o.length;t++)o[t].remove();a();let n=e.getSelection(),r=document.createRange();t?(r.setStartAfter(t),n.removeAllRanges(),n.addRange(r)):i&&(r.setStartBefore(i),n.removeAllRanges(),n.addRange(r))},n=function(t){!t.ctrlKey||"z"!==t.key&&"Z"!==t.key||(i(),t.preventDefault())},r=document.execCommand,a=function(){e._elemento.removeEventListener("keydown",n),e._elemento.removeEventListener("keypress",a),document.execCommand=r};e._elemento.addEventListener("keydown",n),e._elemento.addEventListener("keypress",a),document.execCommand=function(t){if("undo"!==t)return r.apply(document,arguments);i()}}(t,e);let i,n=t.lastChild,r=e.getSelection(),a=r.getRangeAt(0),s=a.startContainer,l=t.firstChild.nodeType!==Node.TEXT_NODE&&s!==e._elemento&&0===s.textContent.trim().length;if(a.collapsed&&s===e._elemento){for(let t=e._elemento.querySelectorAll("br"),o=0;o<t.length;o++)t[o].remove();for(let t=e._elemento.querySelectorAll("*:empty"),o=0;o<t.length;o++)t[o].remove();for(let e=t.firstChild;e&&e.nodeType===Node.TEXT_NODE;e=t.firstChild){let o=document.createElement("p");o.appendChild(e),o.setAttribute("data-tipo","artigo"),t.insertBefore(o,t.firstElementChild)}i=t.firstElementChild,a.insertNode(t)}else{i=l?t.firstElementChild:s.nodeType===Node.ELEMENT_NODE?s:s.parentElement;for(let e=t.firstChild;e&&e.nodeType===Node.TEXT_NODE;e=t.firstChild)a.insertNode(e);let o=a.endContainer;for(;o.parentElement!==e._elemento;)o=o.parentElement;o.parentElement.insertBefore(t,o.nextSibling)}l&&s.remove(),r.removeAllRanges(),a=document.createRange(),a.setStartAfter(n),r.addRange(a),e.atualizarContexto();let c=n.nodeType===Node.ELEMENT_NODE?n:n.parentElement;for(let t=i;t&&t!==c;t=t.nextElementSibling)o.validar(t)}(o,this.editorCtrl,this.validacaoCtrl)}},Q=class extends e{constructor(t){super("change",{bubbles:!0,cancelable:!1})}};class J{constructor(t){this._editorCtrl=t,t.registrarEventListener("focus",(e=>{this._comFoco=!0,this.iniciar(e.target,t)}),!0),t.registrarEventListener("blur",(e=>{this._comFoco=!1,this.finalizar(e.target,t),this.comprometer()}),!0)}get alterado(){throw"Não implementado."}set alterado(t){throw"Não implementado."}iniciar(t,e){throw"Não implementado"}finalizar(t,e){throw"Não implementado"}comprometer(){this.alterado&&(this.alterado=!1,this._editorCtrl.dispatchEvent(new Q(this._editorCtrl)))}}class Y extends J{constructor(t){super(t),this._observer=new MutationObserver(this._mutationCallback.bind(this)),this._iniciado=!1,this._alterado=!1}get alterado(){return this._alterado}set alterado(t){this._alterado=t,this._alterado||this._conectado||!this._comFoco||this.iniciar(this._editorCtrl._elemento,this._editorCtrl),this._alterado&&!this._comFoco&&this.comprometer(),this._alterado&&this.finalizar()}iniciar(t,e){this._conectado||(this._observer.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._conectado=!0),this._iniciado=!0}finalizar(t,e){this._conectado&&(this._observer.disconnect(),this._conectado=!1),this._iniciado=!1}_mutationCallback(){try{this._conectado=!1,this._observer.disconnect()}finally{this.alterado=!0}}}class tt extends J{constructor(t){super(t),this._alteradoCache=!1}get alterado(){return!!this._alteradoCache||(this._alteradoCache=this._editorCtrl.lexmlString!==this._lexml,this._alteradoCache)}set alterado(t){this._lexml=t?"":this._editorCtrl.lexmlString,this._alteradoCache=!!t,t&&!this._comFoco&&this.comprometer()}iniciar(t,e){this._lexml=e.lexmlString}finalizar(t,e){}}function et(t,e,o){for(;!t.hasAttribute("data-tipo");)t=t.parentNode;let i=new Set(e),n=new Set(o);for(let e=t.previousElementSibling;e;e=e.previousElementSibling){let t=e.getAttribute("data-tipo");if(i.has(t))return e;if(n.has(t))return null}return null}function ot(t,e,o){for(;!t.hasAttribute("data-tipo");)t=t.parentNode;let i=new Set(e),n=new Set(o);for(let e=t.nextElementSibling;e;e=e.nextElementSibling){let t=e.getAttribute("data-tipo");if(i.has(t))return e;if(n.has(t))return null}return null}const it=class{constructor(t,e,o){this.dispositivo=t,this.tipo=e,this.descricao=o}},nt=class{constructor(t,e){this.tipos=t instanceof Array?new Set(t):new Set([t]),this.descricao=e}aplicaSeA(t){return this.tipos.has(t.getAttribute("data-tipo"))}validar(t){throw"Não implementado."}},rt=class extends nt{constructor(){super(["artigo","paragrafo"],"Artigos e parágrafos não devem ser escritos usando apenas caixa alta.")}validar(t){var e=t.textContent;return 0===e.length||e.toUpperCase()!==e}};function at(t,e,o){return t?e(t):o}const st=class extends nt{constructor(){super("continuacao","Citações devem estar entre aspas e terminar com ponto final (.).")}validar(t){let e=t.textContent.trim();return t===at(et(t,["artigo"]),(t=>t.nextElementSibling),t)?/^["“]/.test(e):t===at(ot(t,["continuacao","artigo","paragrafo","inciso"]),(t=>"continuacao"===t.getAttribute("data-tipo")?t:t.previousElementSibling),t)?/.+[”"]\.$/.test(e):!/[“”"]/.test(e)}},lt=class extends nt{constructor(){super(["inciso","alinea","item"],"Enumerações devem possuir mais de um elemento.")}validar(t){var e=t.getAttribute("data-tipo"),o=function(t){return{inciso:["artigo","paragrafo"],alinea:["artigo","paragrafo","inciso"],item:["artigo","paragrafo","inciso","alinea"]}[t]||[]}(e);return!!et(t,[e],o)||!!ot(t,[e],o)}},ct=class extends nt{constructor(){super(["artigo","paragrafo"],"Artigos e parágrafos devem ser iniciados com letra maiúscula.")}validar(t){var e=t.textContent.trim();return e.charAt(0).toUpperCase()===e.charAt(0)}},dt=class extends nt{constructor(){super(["artigo","paragrafo"],"Artigos e parágrafos devem ser terminados com ponto final (.) ou dois pontos (:), sem espaço antes da pontuação.")}validar(t){return/.*\S+[:.]$/.test(t.textContent.trim())}},ut=class extends nt{constructor(){super(["inciso","alinea","item"],"Enumerações devem ser terminadas com ponto final (.), ponto e vírgula (;) ou dois pontos (:), sem espaço antes da pontuação.")}validar(t){return/.*\S+(?:[;.:]|; ou|; e)$/.test(t.textContent.trim())}},pt=class extends nt{constructor(){super(["artigo","paragrafo","inciso","alinea","item"],"Dispositivos devem conter uma única sentença.")}validar(t){let e=t.textContent.trim(),o=/[.;:]\s*(\S)/g,i=!0;for(let t=o.exec(e);t&&i;t=o.exec(e))i=t[1].toLowerCase()===t[1];return i}};function mt(t,e,o,i){!0!==t&&!1===t[e]||o.push({validador:new i,opcao:e})}const gt=class{constructor(t){this.validadores=[],!1!==t&&(mt(t,"caixaAlta",this.validadores,rt),mt(t,"citacao",this.validadores,st),mt(t,"enumeracaoElementos",this.validadores,lt),mt(t,"inicialMaiuscula",this.validadores,ct),mt(t,"pontuacao",this.validadores,dt),mt(t,"pontuacaoEnumeracao",this.validadores,ut),mt(t,"sentencaUnica",this.validadores,pt))}validar(t){if(!t)return;let e=[];return t.textContent.trim().length>0&&(this.validadores.forEach((o=>{var i=o.validador,n=o.opcao;i.aplicaSeA(t)&&!i.validar(t)&&e.push(new it(t,n,i.descricao))})),e.length>0?t.setAttribute("data-invalido",e.reduce(((t,e)=>t?t+" "+e.descricao:e.descricao),null)):t.removeAttribute("data-invalido")),e}};var ht=!1;function ft(t){var e=t.getSelection(),o=e&&e.rangeCount>0?e.getRangeAt(0):null;if(o){let i=o?o.startContainer:null;if(!i)return null;if(i.nodeType===Node.ELEMENT_NODE&&"BR"!==i.nodeName||(i=i.parentNode),i===t._elemento){let n=!0;if(i.firstElementChild&&i.firstElementChild.hasAttribute("data-tipo"))if(o.collapsed&&o.startOffset===i.childNodes.length)do{i=i.lastElementChild}while(i.lastElementChild);else if(o.collapsed&&0===o.startOffset)do{i=i.firstElementChild}while(i.firstElementChild);else n=!1;else t.limpar(),i=t._elemento.firstElementChild;return n&&(e.removeAllRanges(),(o=document.createRange()).setStart(i,0),e.addRange(o)),i}if(i.compareDocumentPosition(t._elemento)&Node.DOCUMENT_POSITION_CONTAINS)return i}return null}function bt(t,e){return t&&!e[t]?bt({titulo:"capitulo",capitulo:"artigo",secao:"artigo",subsecao:"artigo"}[t],e):t||"artigo"}const vt=class{constructor(t,e){if(!(t instanceof Element))throw"Elemento não é um elemento do DOM.";Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t){if(null==t)throw new TypeError("Cannot convert first argument to object");for(var e=Object(t),o=1;o<arguments.length;o++){var i=arguments[o];if(null!=i){i=Object(i);for(var n=Object.keys(Object(i)),r=0,a=n.length;r<a;r++){var s=n[r],l=Object.getOwnPropertyDescriptor(i,s);void 0!==l&&l.enumerable&&(e[s]=i[s])}}}return e}}),"lastElementChild"in DocumentFragment.prototype||Object.defineProperty(DocumentFragment.prototype,"lastElementChild",{get:function(){for(var t=this.lastChild;t&&t.nodeType!==Node.ELEMENT_NODE;)t=t.previousSibling;return t}});let o=Object.create(w);var i,n;Object.assign(o,e),e&&e.rotulo&&Object.setPrototypeOf(o.rotulo,w.rotulo),this.opcoes=o,Object.freeze(o),Object.freeze(o.rotulo),Object.freeze(o.validacao),t=function(t,e,o){let i=document.createElement("style");if(i.innerHTML="\n.silegismg-editor-articulacao {\n  counter-reset: parte livro titulo capitulo secao subsecao artigo;\n  outline: none;\n}\n\n.silegismg-editor-articulacao p:before {\n  font-weight: bolder;\n  animation: .25s ease-in rotulo;\n}\n\n.silegismg-editor-articulacao p[data-tipo]:before {\n  display: inline-block; /* Resolve problema de cursor antes do rótulo no chrome */\n  margin-right: 1ex;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p {\n  text-indent: 4ex;\n  text-align: justify;\n  border-left: solid 2px transparent;\n  padding-left: 1ex;\n}\n\n.silegismg-editor-articulacao p[data-invalido] {\n  border-left-color: red;\n}\n\n.silegismg-editor-articulacao p[data-invalido]:after {\n  display: block;\n  content: attr(data-invalido);\n  color: red;\n  text-indent: 0;\n  margin-left: auto;\n  font-size: 90%;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"titulo\"]:before {\n  content: 'Título ' counter(titulo, upper-roman);\n  counter-increment: titulo;\n  display: block;\n  text-align: center;\n  margin-right: 0;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"titulo\"] {\n  counter-reset: capitulo;\n  text-transform: uppercase;\n  font-weight: bolder;\n  font-size: 110%;\n  text-align: center;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"capitulo\"]:before {\n  content: 'Capítulo ' counter(capitulo, upper-roman);\n  counter-increment: capitulo;\n  display: block;\n  text-align: center;\n  font-weight: normal;\n  margin-right: 0;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"capitulo\"] {\n  counter-reset: secao;\n  text-transform: uppercase;\n  font-size: 110%;\n  text-align: center;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"secao\"]:before {\n  content: 'Seção ' counter(secao, upper-roman);\n  counter-increment: secao;\n  display: block;\n  text-align: center;\n  margin-right: 0;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"secao\"] {\n  counter-reset: subsecao;\n  font-weight: bolder;\n  font-size: 110%;\n  text-align: center;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"subsecao\"]:before {\n  content: 'Subseção ' counter(subsecao, upper-roman);\n  counter-increment: subsecao;\n  display: block;\n  text-align: center;\n  margin-right: 0;\n  text-indent: 0;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"subsecao\"] {\n  font-weight: bolder;\n  font-size: 110%;\n  text-align: center;\n  text-indent: 0;\n}\n\n\n.silegismg-editor-articulacao p[data-tipo=\"artigo\"]:before {\n  content: 'Art. ' counter(artigo) 'º' '${separadorArtigo}';\n  counter-increment: artigo;\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"artigo\"].emenda:before {\n  content: 'Art. ' counter(artigo) 'º-' counter(emenda, upper-latin) '${separadorArtigo}';\n  counter-increment: emenda;\n}\n\n/* A partir do artigo 10, não se usa \"º\" */\n\n.silegismg-editor-articulacao p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda):before {\n  content: 'Art. ' counter(artigo) '${separadorArtigoSemOrdinal}';\n}\n\n.silegismg-editor-articulacao p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"]:not(.emenda) ~ p[data-tipo=\"artigo\"].emenda:before {\n  content: 'Art. ' counter(artigo) '-' counter(emenda, upper-latin) '${separadorArtigoSemOrdinal}';\n}\n\n.silegismg-editor-articulacao p[data-tipo='artigo'] {\n  counter-reset: paragrafo inciso emenda;\n}\n\n.silegismg-editor-articulacao p[data-tipo='artigo'].emenda {\n  counter-reset: paragrafo inciso;\n}\n\n.silegismg-editor-articulacao p[data-tipo='paragrafo'] {\n  counter-reset: inciso;\n}\n\n.silegismg-editor-articulacao p[data-tipo='paragrafo']:before {\n  content: '§ ' counter(paragrafo) 'º' '${separadorParagrafo}';\n  counter-increment: paragrafo;\n}\n\n.silegismg-editor-articulacao p.semOrdinal[data-tipo='paragrafo']:before {\n  content: '§ ' counter(paragrafo) '${separadorParagrafoSemOrdinal}';\n  counter-increment: paragrafo;\n}\n\n.silegismg-editor-articulacao p[data-tipo='paragrafo'].unico:before {\n  content: 'Parágrafo único${separadorParagrafoUnico}';\n}\n\n.silegismg-editor-articulacao p[data-tipo='inciso'] {\n  counter-reset: alinea;\n}\n\n.silegismg-editor-articulacao p[data-tipo='inciso']:before {\n  content: counter(inciso, upper-roman) '${separadorInciso}';\n  counter-increment: inciso;\n}\n\n.silegismg-editor-articulacao p[data-tipo='alinea'] {\n  counter-reset: item;\n}\n\n.silegismg-editor-articulacao p[data-tipo='alinea']:before {\n  content: counter(alinea, lower-latin) '${separadorAlinea}';\n  counter-increment: alinea;\n}\n\n.silegismg-editor-articulacao p[data-tipo='item']:before {\n  content: counter(item) '${separadorItem}';\n  counter-increment: item;\n}\n\n\n/* O primeiro artigo não deve ter margem superior */\n\n.silegismg-editor-articulacao > *:first-child {\n  margin-top: 0;\n}\n\n\n/* O último artigo não deve ter margem inferior */\n\n.silegismg-editor-articulacao > *:last-child {\n  margin-bottom: 0;\n}\n\n@keyframes rotulo {\n  0% {\n    opacity: 0;\n  }\n  10% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n".toString().replace(/\${(.+?)}/g,((t,e)=>o.rotulo[e])),o.shadowDOM&&"attachShadow"in t){let n=document.createElement("style");n.innerHTML="\n:host {\n    display: block;\n    text-indent: 4ex;\n}\n\n:host([disabled]) {\n    color: gray;\n}\n\n.silegismg-editor-articulacao p {\n    text-indent: inherit !important;\n}\n\n.silegismg-editor-articulacao p:before {\n    color: var(--rotulo-cor, currentColor);\n    font-weight: var(--rotulo-peso, bolder);\n    background: var(--rotulo-background, inherit);\n}\n".toString();let r=t.attachShadow({mode:"string"==typeof o.shadowDOM?o.shadowDOM:"open"});e.dispatchEvent=t.dispatchEvent.bind(t),e.getSelection=()=>r.getSelection();let a=document.createElement("div");return a.contentEditable=!o.somenteLeitura,a.spellcheck=t.spellcheck,a.classList.add("silegismg-editor-articulacao"),r.appendChild(i),r.appendChild(n),r.appendChild(a),t.addEventListener("focus",(t=>a.focus())),t.focus=function(){a.focus()},a}if(t.contentEditable=!o.somenteLeitura,t.classList.add("silegismg-editor-articulacao"),!ht){let t=document.querySelector("head");t?t.appendChild(i):document.body.appendChild(i),ht=!0}return t}(t,this,o),Object.defineProperty(this,"_elemento",{value:t}),this._handlers=[],this.opcoes.somenteLeitura||(this._registrarEventos(),o.transformacaoAutomatica&&function(t,e){var o={},i=[];m(o,new l),m(o,new c),m(o,new d),m(o,new u),m(o,new p),t.registrarEventListener("keypress",(n=>i=function(t,e,o,i,n){var r=[],a=t.charCode||t.keyCode;return o.forEach((function(t){t[a]&&r.push(t[a])})),e[a]&&r.push(e[a]),r.forEach((function(e){e.$handler&&e.$handler.forEach((e=>e.handler(n,i,i.contexto,e.sequencia.replace(/\r/g,"\n"),t)))})),r}(n,o,i,t,e))),t.registrarEventListener("mouseup",(t=>i=[])),t.registrarEventListener("touchend",(t=>i=[]))}(this,t),this.controleAlteracao=(n=this,"MutationObserver"in window?new Y(n):new tt(n)),this.validacaoCtrl=new gt(this.opcoes.validacao),this.clipboardCtrl=new Z(this,this.validacaoCtrl),/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&(g(i=this,"alterarTipoDispositivoSelecionado",f),i.registrarEventListener("keydown",(t=>function(t,e){if(!t.ctrlKey&&!t.altKey&&!t.metaKey&&1===t.key.length||"Delete"===t.key||"Backspace"===t.key||"Enter"===t.key){let o=e.getSelection().getRangeAt(0);if(!o.collapsed){let i=o.startContainer.parentNode,n=o.endContainer.parentNode;o.deleteContents(),"Delete"!==t.key&&"Backspace"!==t.key||t.preventDefault(),i!==n?(i!=e._elemento&&0===i.textContent.length&&i.remove(),n!=e._elemento&&0===n.textContent.length&&n.remove(),0===e._elemento.children.length&&e.limpar()):0===i.textContent.length&&0===i.children.length&&(i.innerHTML="<br>")}}}(t,i))),i.limpar=function(){this._elemento.innerHTML='<p data-tipo="artigo" style="min-height: 1em;"><br>\n</p>'}),/Trident\//.test(navigator.userAgent)&&x(this)),this.limpar()}dispatchEvent(t){this._elemento.dispatchEvent(t.getCustomEvent())}getSelection(){return document.getSelection()}get vazio(){return!this._elemento.firstElementChild||this._elemento.firstElementChild===this._elemento.lastElementChild&&""===this._elemento.textContent}get lexml(){try{return this.vazio?document.createDocumentFragment():I(this._elemento,this.opcoes.rotulo)}catch(t){if(t instanceof A){for(let t=this._elemento.firstElementChild;t;t=t.nextElementSibling)this._normalizarDispositivo(t);return I(this._elemento)}throw t}}set lexml(t){let e=C(t);if(this._elemento.innerHTML="",this._elemento.appendChild(e),this.vazio&&this.limpar(),!this.opcoes.somenteLeitura&&(this.controleAlteracao.comprometer(),this.opcoes.validarAoAtribuir))for(let t=this._elemento.firstElementChild;t;t=t.nextElementSibling)this.validacaoCtrl.validar(t)}limpar(){this._elemento.innerHTML='<p data-tipo="artigo"><br></p>'}get lexmlString(){var t=this.lexml,e=(new XMLSerializer).serializeToString(t);return this.opcoes.escaparXML?function(t){return t.replace(/[\u0001-\u0008\u000B-\u000C\u000E\u001F]/gm,"").replace(/[\u00A0-\u9999]/gm,(function(t){return"&#"+t.charCodeAt(0)+";"}))}(e):e}set lexmlString(t){this.lexml=t}get alterado(){return this.controleAlteracao.alterado}_registrarEventos(){let t=this._cursorEventHandler.bind(this);["focus","keyup","mousedown","touchstart","mouseup","touchend"].forEach((e=>this.registrarEventListener(e,t))),this.registrarEventListener("keydown",this._keyDownEventHandler.bind(this)),this.registrarEventListener("blur",(t=>{if(!this.opcoes.somenteLeitura){this.vazio&&this.limpar();let t=this.contexto;t&&t.cursor.dispositivo&&this.validacaoCtrl.validar(this.contexto.cursor.dispositivo)}}))}registrarEventListener(t,e,o){this._handlers.push({evento:t,handler:e}),this._elemento.addEventListener(t,e,o)}desregistrar(){this._handlers.forEach((t=>this._elemento.removeEventListener(t.evento,t.handler))),this._handlers=[]}_cursorEventHandler(t){this.atualizarContexto(),this._normalizarContexto(),t instanceof KeyboardEvent&&t.key&&1===t.key.length&&this.contexto.cursor.dispositivo&&this.contexto.cursor.dispositivo.hasAttribute("data-invalido")&&this.contexto.cursor.dispositivo.removeAttribute("data-invalido")}_keyDownEventHandler(t){this.contexto&&this.contexto.cursor.elemento||this._cursorEventHandler(t);let e=ft(this);this.contexto&&e===this.contexto.cursor.elemento||this._cursorEventHandler(t)}_normalizarContexto(){if(!this.contexto)return;let t=this.contexto.cursor.dispositivo;t&&(this._normalizarDispositivo(t.previousElementSibling),this._normalizarDispositivo(t,this.contexto),this._normalizarDispositivo(t.nextElementSibling),this.opcoes.somenteLeitura||(this.validacaoCtrl.validar(t.previousElementSibling),this.validacaoCtrl.validar(t.nextElementSibling)))}atualizarContexto(){var t=ft(this);if(!t){if(!this.contexto)return;t=this.contexto.cursor.elemento}if(t===this._elemento&&(!this._elemento.firstElementChild||this._elemento.firstElementChild===this._elemento.lastElementChild&&"BR"===this._elemento.firstElementChild.tagName)){this.limpar(),t=this._elemento.firstElementChild;let e=this.getSelection();e.removeAllRanges();let o=document.createRange();o.selectNodeContents(t),e.addRange(o)}var e=new i(this._elemento,t);return this.contexto&&this.contexto.cursor.elemento===t&&!this.contexto.comparar(e)||(this.contexto&&this.contexto.cursor.dispositivo&&!this.opcoes.somenteLeitura&&this.validacaoCtrl.validar(this.contexto.cursor.dispositivo),this.contexto=e,this.dispatchEvent(new o(e))),e}alterarTipoDispositivoSelecionado(t){if(this.atualizarContexto(),!this.contexto)throw"Não há contexto atual.";if(!this.contexto.permissoes[t])throw"Tipo não permitido: "+t;let e=this.contexto.cursor.dispositivo;this._definirTipo(e,t);let o=this.getSelection(),i=o&&o.rangeCount>0?o.getRangeAt(0):null,n=i?i.endContainer:null;if(n){for(;n!==this._elemento&&(n.nodeType!==Node.ELEMENT_NODE||!n.hasAttribute("data-tipo"));)n=n.parentElement;for(;e!==n&&e;)e=e.nextElementSibling,this._definirTipo(e,t)}this.atualizarContexto()}_definirTipo(t,e){if(t.getAttribute("data-tipo")!==e){t.setAttribute("data-tipo",e),t.classList.remove("unico");try{this._normalizarContexto()}finally{this.controleAlteracao.alterado=!0}}}_normalizarDispositivo(t,e){for(;t&&!t.hasAttribute("data-tipo");)t=t.parentElement;if(t){if(e){if(!(e instanceof i))throw"Conexto não é instância de ContextoArticulacao."}else e=new i(this._elemento,t);if(e&&!e.permissoes[t.getAttribute("data-tipo")])try{let o=t.previousElementSibling;this._normalizarDispositivo(o),t.setAttribute("data-tipo",bt(o.getAttribute("data-tipo")||"continuacao",e.permissoes)),this._normalizarDispositivo(t.nextElementSibling)}catch(e){t.setAttribute("data-tipo","artigo"),console.error(e)}"paragrafo"===t.getAttribute("data-tipo")&&this._normalizarParagrafo(t)}}_normalizarParagrafo(t){let e=et(t,["artigo","paragrafo"]),o=ot(t,["artigo","paragrafo"]);if("paragrafo"===t.getAttribute("data-tipo")||"continuacao"===t.getAttribute("data-tipo"))if(t.classList.toggle("unico",!(e&&"paragrafo"===e.getAttribute("data-tipo")||o&&"paragrafo"===o.getAttribute("data-tipo"))),e&&"paragrafo"===e.getAttribute("data-tipo")&&e.classList.remove("unico"),o&&"paragrafo"===o.getAttribute("data-tipo")&&o.classList.remove("unico"),e&&e.classList.contains("semOrdinal"))t.classList.add("semOrdinal");else{let o,i;for(o=1,i=e;o<10&&i&&"paragrafo"===i.getAttribute("data-tipo");o++)i=et(i,["artigo","paragrafo"]);t.classList.toggle("semOrdinal",o>=10)}else!e||"paragrafo"!==e.getAttribute("data-tipo")||o&&"paragrafo"===o.getAttribute("data-tipo")?e&&"paragrafo"===e.getAttribute("data-tipo")||!o||"paragrafo"!==o.getAttribute("data-tipo")||this._normalizarParagrafo(o):e.classList.add("unico")}},xt=class{constructor(e,o){var i,n,r,a;if(o.shadowDOM&&"attachShadow"in e){let s=e.attachShadow({mode:"string"==typeof o.shadowDOM?o.shadowDOM:"open"});s.innerHTML=t.toString(),i=s.querySelector(".silegismg-editor-conteudo"),r=s.querySelector(".silegismg-editor-botoes"),n=r.querySelectorAll("button[data-tipo-destino]"),e.addEventListener("focus",(t=>i.focus())),e.focus=function(){i.focus()},e.ctrlArticulacao=this.ctrl=a=new vt(i,o)}else e.innerHTML=t.toString(),i=e.querySelector(".silegismg-editor-conteudo"),r=e.querySelector(".silegismg-editor-botoes"),n=e.querySelectorAll("button[data-tipo-destino]"),e.ctrlArticulacao=this.ctrl=a=new vt(i,o);function s(t){a.alterarTipoDispositivoSelecionado(t.target.getAttribute("data-tipo-destino")),i.focus()}this.ctrl.dispatchEvent=t=>e.dispatchEvent(t.getCustomEvent());for(let t=0;t<n.length;t++)n[t].addEventListener("click",s.bind(this));e.addEventListener("contexto",(function(t){for(let e=0;e<n.length;e++)n[e].disabled=!t.detail.permissoes[n[e].getAttribute("data-tipo-destino")],n[e].classList.remove("atual");let e=r.querySelector('button[data-tipo-destino="'+t.detail.cursor.tipo+'"]');e&&e.classList.add("atual")})),e.addEventListener("scroll",(function(t){r.style.position="relative",r.style.top=e.scrollTop+"px"}))}};window.silegismgEditorArticulacao=function(t,e){return t.componenteEdicao=new xt(t,e),Object.defineProperty(t,"lexml",{get:function(){return this.componenteEdicao.ctrl.lexml},set:function(t){this.componenteEdicao.ctrl.lexml=t}}),t.componenteEdicao},window.silegismgEditorArticulacaoController=function(t,e){return t.ctrlArticulacao=new vt(t,e),Object.defineProperty(t,"lexml",{get:function(){return this.ctrlArticulacao.lexml},set:function(t){this.ctrlArticulacao.lexml=t}}),t.ctrlArticulacao},window.silegismgInterpretadorArticulacao=W})();